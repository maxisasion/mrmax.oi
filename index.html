<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>FX Bulls PRO • MT5 bottom tabs</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ############### COMPLETE DARK THEME – KEEP EVERY ORIGINAL COLOR ############### */
        :root {
            --primary-color: #00ff00;
            --secondary-color: #008800;
            --danger-color: #ff3333;
            --dark-color: #0a0a0a;
            --darker-color: #050505;
            --light-color: #cccccc;
            --gold: #FFD700;
            --bitcoin: #F7931A;
            --session-london: #3498db;
            --session-ny: #e74c3c;
            --session-asia: #9b59b6;
            --confidence-high: #00ff00;
            --confidence-medium: #ffff00;
            --confidence-low: #ff6600;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: var(--darker-color);
            color: var(--light-color);
            line-height: 1.6;
            text-shadow: 0 0 1px var(--primary-color);
            padding-bottom: 80px; /* space for bottom nav */
            position: relative;
            min-height: 100vh;
        }
        .container {
            max-width: 100%;
            padding: 12px 12px 70px;
        }
        .card {
            background: var(--dark-color);
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            margin-bottom: 20px;
            overflow: hidden;
        }
        .card-header {
            background: linear-gradient(90deg, var(--dark-color), var(--darker-color));
            color: var(--primary-color);
            padding: 15px;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 5px var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        .card-body { padding: 20px; }

        /* BOTTOM NAVIGATION – 5 TABS (always below) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #0a0a0a;
            border-top: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 4px;
            z-index: 1000;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.8);
        }
        .nav-item {
            background: transparent;
            border: none;
            color: var(--light-color);
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: bold;
            padding: 8px 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            border-radius: 8px;
            transition: 0.2s;
            flex: 1;
            cursor: pointer;
        }
        .nav-item i {
            font-size: 22px;
            color: var(--primary-color);
            text-shadow: 0 0 3px green;
        }
        .nav-item span {
            font-size: 11px;
            letter-spacing: 1px;
        }
        .nav-item.active {
            background: rgba(0,255,0,0.2);
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        .nav-item.active i { color: var(--primary-color); }

        /* panels */
        .mt5-panel { display: none; animation: fade 0.2s; }
        .mt5-panel.active-panel { display: block; }
        @keyframes fade { 0%{opacity:0.7;} 100%{opacity:1;} }

        /* ---------- ALL ORIGINAL STYLES - KEEP EXACT ---------- */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--light-color); }
        input, select {
            width: 100%; padding: 10px; background: rgba(255,255,255,0.1);
            border: 1px solid var(--primary-color); border-radius: 5px; font-size: 16px;
            font-family: 'Orbitron', sans-serif; color: var(--light-color);
        }
        input:focus, select:focus { outline: none; box-shadow: 0 0 10px rgba(0,255,0,0.5); }
        button {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: black; border: none; padding: 12px; border-radius: 5px; font-size: 16px;
            font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s;
            font-family: 'Orbitron', sans-serif; text-shadow: 0 0 3px white;
            border: 1px solid var(--primary-color);
        }
        button:hover {
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            box-shadow: 0 0 15px var(--primary-color);
        }
        button.danger { background: linear-gradient(90deg, var(--danger-color), #cc0000); border: 1px solid var(--danger-color); }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .hidden { display: none; }
        .spinner {
            border: 4px solid rgba(0,0,0,0.1); border-radius: 50%; border-top: 4px solid var(--primary-color);
            width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* signal container – with 2 take profits */
        .signal-container {
            background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; margin: 15px 0;
            border-left: 4px solid var(--primary-color); box-shadow: 0 0 10px rgba(0,255,0,0.2);
        }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .signal-pair { font-weight: bold; font-size: 20px; color: var(--primary-color); }
        .signal-direction { font-size: 16px; padding: 6px 14px; border-radius: 4px; font-weight: bold; }
        .signal-direction.buy { background: rgba(0,255,0,0.2); color: var(--primary-color); border:1px solid var(--primary-color); }
        .signal-direction.sell { background: rgba(255,0,0,0.2); color: var(--danger-color); border:1px solid var(--danger-color); }
        .signal-confidence { display: flex; align-items: center; margin:10px 0; padding:10px; background: rgba(0,0,0,0.5); border-radius:5px; }
        .confidence-meter { flex:1; height:10px; background: rgba(255,255,255,0.1); border-radius:5px; margin:0 10px; overflow:hidden; }
        .confidence-fill { height:100%; border-radius:5px; transition: width 0.5s ease; }
        .confidence-fill.high { background: linear-gradient(90deg, var(--confidence-high), #008800); }
        .confidence-fill.medium { background: linear-gradient(90deg, var(--confidence-medium), #888800); }
        .confidence-fill.low { background: linear-gradient(90deg, var(--confidence-low), #884400); }
        .confidence-value { font-weight: bold; min-width:60px; text-align:center; }

        /* details with 2 TP */
        .signal-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }
        .signal-detail {
            background: rgba(0,0,0,0.5); padding: 10px 5px; border-radius: 5px;
            text-align: center; border: 1px solid rgba(0,255,0,0.1);
        }
        .detail-label { font-size: 11px; color: var(--light-color); margin-bottom: 4px; }
        .detail-value { font-size: 14px; font-weight: bold; color: var(--primary-color); }

        /* session */
        .session-container { background: rgba(0,0,0,0.3); border-radius:8px; padding:15px; margin:15px 0; border:1px solid rgba(255,255,255,0.1); }
        .session-header { display: flex; justify-content: space-between; align-items: center; }
        .session-title { font-weight: bold; color: var(--primary-color); }
        .session-status { display: flex; align-items: center; font-size:14px; }
        .session-dot { width:12px; height:12px; border-radius:50%; margin-right:8px; }
        .session-dot.active { background-color: var(--primary-color); box-shadow:0 0 10px var(--primary-color); animation:pulse 2s infinite; }
        .session-dot.inactive { background-color: var(--danger-color); }
        @keyframes pulse { 0%{opacity:1;} 50%{opacity:0.5;} 100%{opacity:1;} }
        .session-info { display: grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
        .session-item { background: rgba(0,0,0,0.5); padding:8px; border-radius:5px; border-left:3px solid var(--primary-color); }
        .session-item.london { border-left-color: var(--session-london); }
        .session-item.ny { border-left-color: var(--session-ny); }
        .session-item.asia { border-left-color: var(--session-asia); }

        .chart-container { height: 400px; margin: 10px 0; border-radius:8px; overflow:hidden; border:1px solid var(--primary-color); }
        iframe { width:100%; height:100%; border:none; }

        .error-message { color: var(--danger-color); background: rgba(255,0,0,0.1); padding:10px; border-radius:4px; margin:10px 0; }
        .owner-info { background: rgba(0,255,0,0.05); padding:15px; border-radius:5px; margin-top:20px; font-size:14px; border:1px solid rgba(0,255,0,0.1); }
        .bitcoin { color: var(--bitcoin); }
        .gold { color: var(--gold); }
        .form-toggle { text-align: center; margin:15px 0; }
        .form-toggle a { color: var(--primary-color); text-decoration: none; font-weight: bold; cursor: pointer; }
        .license-key-display { background: rgba(0,255,0,0.05); padding:15px; border-radius:5px; margin-top:15px; border:1px dashed var(--primary-color); text-align:center; }
        .license-key { font-size:18px; font-weight: bold; letter-spacing:1px; color: var(--primary-color); margin:10px 0; padding:10px; background: rgba(0,0,0,0.5); border-radius:5px; border:1px solid var(--primary-color); }
        .activation-message { background: rgba(0,255,0,0.05); padding:15px; border-radius:5px; margin:15px 0; text-align:center; border:1px solid rgba(0,255,0,0.1); }
        .refresh-btn { width: auto; padding:10px 20px; display: inline-flex; align-items:center; justify-content:center; margin-top:5px; }
        .trading-style-info { background: rgba(0,255,0,0.05); padding:10px; border-radius:5px; margin:10px 0; text-align:center; border:1px solid rgba(0,255,0,0.1); }

        /* HAMBURGER menu (keep) */
        .hamburger-menu { position: absolute; left: 15px; top:50%; transform:translateY(-50%); cursor: pointer; z-index:1000; }
        .hamburger-menu span { display:block; width:25px; height:3px; background-color: var(--primary-color); margin:4px 0; transition:0.3s; }
        .menu-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.9); z-index:999; display:none; }
        .menu-content { position:fixed; top:0; left:-300px; width:280px; height:100%; background:linear-gradient(180deg, var(--dark-color), var(--darker-color)); color: var(--light-color); z-index:1000; transition: left 0.3s ease; overflow-y:auto; padding:20px; box-shadow:2px 0 10px rgba(0,0,0,0.8); border-right:2px solid var(--primary-color); }
        .menu-content.active { left:0; }
        .menu-header { text-align:center; margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid var(--primary-color); }
        .menu-header h3 { color: var(--primary-color); }
        .menu-section { margin-bottom:20px; padding:15px; background:rgba(0,0,0,0.3); border-radius:5px; border:1px solid rgba(0,255,0,0.1); }
        .menu-section h4 { color: var(--primary-color); margin-bottom:10px; font-size:14px; border-bottom:1px solid rgba(0,255,0,0.2); padding-bottom:5px; }
        .user-detail { margin-bottom:8px; font-size:12px; }
        .user-detail strong { color: var(--primary-color); }
        .signal-history-item { background: rgba(0,0,0,0.5); padding:10px; margin-bottom:8px; border-radius:4px; font-size:11px; border-left:3px solid var(--primary-color); }
        .close-menu { position:absolute; top:15px; right:15px; color: var(--primary-color); font-size:24px; cursor:pointer; }
        .change-style-btn { background: rgba(0,255,0,0.1); color: var(--primary-color); border:1px solid var(--primary-color); padding:8px 15px; border-radius:4px; font-size:12px; font-weight:bold; cursor:pointer; width:100%; margin-top:10px; }
        .style-options { display:none; margin-top:10px; padding:10px; background:rgba(0,0,0,0.5); border-radius:4px; }
        .style-options.active { display:block; }
        .style-option { display:flex; align-items:center; padding:8px; margin-bottom:5px; background:rgba(0,0,0,0.3); border-radius:3px; cursor:pointer; }
        .style-option:hover { background:rgba(0,255,0,0.1); }
        .style-option.active { background:rgba(0,255,0,0.2); border-left:3px solid var(--primary-color); }

        .powered-by { text-align:center; margin-top:20px; padding:10px; color: var(--primary-color); font-size:12px; border-top:1px solid rgba(0,255,0,0.1); }
        .market-status { display:flex; justify-content:space-around; margin:10px 0; padding:10px; background:rgba(0,0,0,0.3); border-radius:5px; }
        .volatility-indicator { width:100%; height:5px; background:rgba(255,255,255,0.1); border-radius:3px; margin-top:5px; overflow:hidden; }
        .volatility-fill { height:100%; }
        .volatility-low { background: var(--primary-color); width:30%; }
        .volatility-medium { background: var(--confidence-medium); width:60%; }
        .volatility-high { background: var(--danger-color); width:90%; }

        .pay-now-container { margin:15px 0; text-align:center; }
        .pay-now-btn { background:linear-gradient(90deg, #FFD700, #FFA500); color:#000; border:none; padding:15px; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; width:100%; font-family:'Orbitron', sans-serif; border:1px solid #FFD700; display:flex; align-items:center; justify-content:center; gap:10px; }
        .pay-now-btn:hover { background:linear-gradient(90deg, #FFA500, #FFD700); box-shadow:0 0 20px rgba(255,215,0,0.7); }
        .pay-instructions { background:rgba(255,215,0,0.1); padding:15px; border-radius:8px; margin:15px 0; border:1px dashed #FFD700; }

        .signal-history-full { max-height:400px; overflow-y:auto; margin-top:15px; }
        /* fix bottom nav over content */
        .bottom-nav .nav-item { color: #aaa; }
    </style>
</head>
<body>
    <!-- HAMBURGER MENU (intact) -->
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="menu-content" id="menuContent">
        <div class="close-menu" id="closeMenu">&times;</div>
        <div class="menu-header"><h3>FX BULLS PRO</h3><div style="font-size:12px;">POWERED BY FX BULLS PRO</div></div>
        <div class="menu-section"><h4>USER DETAILS</h4>
            <div class="user-detail"><strong>Name:</strong> <span id="menuUserName">Not logged in</span></div>
            <div class="user-detail"><strong>Email:</strong> <span id="menuUserEmail">-</span></div>
            <div class="user-detail"><strong>Trading Style:</strong> <span id="menuTradingStyle">-</span></div>
            <div class="user-detail"><strong>Member Since:</strong> <span id="menuMemberSince">-</span></div>
            <button class="change-style-btn" id="changeStyleBtn"><i class="fas fa-exchange-alt"></i> CHANGE TRADING STYLE</button>
            <div class="style-options" id="styleOptions">
                <div class="style-option" data-style="scalping"><input type="radio" name="tradingStyle" value="scalping"><label> Scalping (1-15m)</label></div>
                <div class="style-option" data-style="day"><input type="radio" name="tradingStyle" value="day"><label> Day Trading (1-4h)</label></div>
                <div class="style-option" data-style="swing"><input type="radio" name="tradingStyle" value="swing"><label> Swing Trading (4h+)</label></div>
            </div>
        </div>
        <div class="menu-section"><h4>TRADING SESSION</h4>
            <div style="display:flex; align-items:center; justify-content:space-between;"><div style="display:flex; align-items:center;"><div class="session-dot" id="sessionDot"></div><span id="sessionStatus">...</span></div><div id="sessionTime">--:--</div></div>
            <div class="user-detail"><strong>Current:</strong> <span id="currentSession">-</span></div>
            <div class="user-detail"><strong>Volatility:</strong> <span id="sessionVolatility">-</span></div>
        </div>
        <div class="menu-section"><h4>SIGNAL CONFIDENCE</h4>
            <div class="user-detail"><strong>Signal:</strong> <span id="menuCurrentSignal">-</span></div>
            <div class="user-detail"><strong>Confidence:</strong> <span id="confidenceLevel">-</span></div>
            <div class="confidence-meter" style="margin:8px 0;"><div class="confidence-fill" id="confidenceFill" style="width:0%"></div></div>
            <div><span id="signalAnalysis">-</span></div>
        </div>
        <div class="menu-section"><h4>HISTORY</h4><div id="signalHistoryList" style="max-height:200px; overflow-y:auto;"></div></div>
        <div style="text-align:center; font-size:10px;">FX Bulls PRO v2.5</div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="hamburger-menu" id="hamburgerMenu"><span></span><span></span><span></span></div>
                <h2>FX BULLS PRO</h2>
            </div>
            <div class="card-body">
                <!-- LOGIN / REGISTER (original, unchanged) -->
                <div id="login-container">
                    <div id="login-form">
                        <h2 style="text-align:center; margin-bottom:20px; color:var(--primary-color);">MEMBER LOGIN</h2>
                        <div class="form-group"><label>EMAIL</label><input id="loginEmail" type="email" placeholder="Your email" /></div>
                        <div class="form-group"><label>PASSWORD</label><input id="loginPassword" type="password" placeholder="Password" /></div>
                        <div class="form-group"><label>LICENSE KEY</label><input id="loginLicenseKey" placeholder="License key" /></div>
                        <button id="loginBtn">LOGIN</button>
                        <div class="form-toggle">Don't have account? <a id="showRegister">Register here</a></div>
                    </div>
                    <div id="register-form" class="hidden">
                        <div class="activation-message"><strong>ACCOUNT VERIFICATION</strong><p>Pay R300 to get activation code</p><p>LIFETIME ACCESS</p></div>
                        <div class="pay-now-container">
                            <button id="payNowButton" class="pay-now-btn" onclick="window.open('https://pay.yoco.com/fx-bulls-pro', '_blank')"><i class="fas fa-lock"></i> PAY NOW R300</button>
                            <div class="pay-instructions"><h4>GET ACTIVATION CODE</h4><p>1. Click PAY NOW</p><p>2. Complete payment</p><p>3. WhatsApp proof to 067 277 1746</p><p>4. Receive activation code</p></div>
                        </div>
                        <div class="form-group"><label>FULL NAME</label><input id="regName" placeholder="Full name" /></div>
                        <div class="form-group"><label>EMAIL</label><input id="regEmail" type="email" placeholder="Email" /></div>
                        <div class="form-group"><label>PASSWORD</label><input id="regPassword" type="password" /></div>
                        <div class="form-group"><label>CONFIRM PASSWORD</label><input id="regConfirmPassword" type="password" /></div>
                        <div class="form-group"><label>TRADING STYLE</label>
                            <select id="tradingStyle">
                                <option value="scalping">Scalping (1-15m)</option>
                                <option value="day">Day Trading (1-4h)</option>
                                <option value="swing">Swing Trading (4h+)</option>
                            </select>
                        </div>
                        <div><div class="form-group"><label>ACTIVATION CODE</label><input id="activationCode" placeholder="Enter code" /></div></div>
                        <button id="registerBtn">COMPLETE REGISTRATION</button>
                        <div class="form-toggle"><a id="showLogin">Login here</a></div>
                    </div>
                    <div id="license-key-display" class="license-key-display hidden">
                        <h4>YOUR LICENSE KEY</h4><p>Save this key</p><div class="license-key" id="generated-license-key"></div>
                        <p><a id="goToLogin">Press here to login</a></p>
                    </div>
                </div>

                <!-- ################ DASHBOARD – MT5 BOTTOM TABS ################ -->
                <div id="dashboard" class="hidden">
                    <!-- welcome + logout -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:var(--primary-color);">WELCOME, <span id="userNameDisplay"></span></h3>
                        <button id="logoutBtn" class="danger" style="width:auto; padding:8px 16px;">LOGOUT</button>
                    </div>
                    <div class="trading-style-info"><strong>STYLE: </strong><span id="userTradingStyleDisplay"></span></div>

                    <!-- 5 PANELS (Quotes, Chart, Trade, History, Settings) -->
                    <!-- PANEL 1 : QUOTES -->
                    <div id="panelQuotes" class="mt5-panel active-panel">
                        <div class="form-group">
                            <label for="pairSelect">SELECT PAIR</label>
                            <select id="pairSelect">
                                <option value="EUR/USD">EUR/USD</option>
                                <option value="GBP/USD">GBP/USD</option>
                                <option value="USD/JPY">USD/JPY</option>
                                <option value="AUD/USD">AUD/USD</option>
                                <option value="USD/CAD">USD/CAD</option>
                                <option value="BTC/USD" class="bitcoin">BTC/USD (BITCOIN)</option>
                                <option value="XAU/USD" class="gold">XAU/USD (GOLD)</option>
                            </select>
                        </div>
                        <div class="market-status">
                            <div><div class="market-status-label">Market</div><div class="market-status-value" id="marketStatus">...</div><div class="volatility-indicator"><div id="volatilityIndicator" class="volatility-fill volatility-low"></div></div></div>
                            <div><div class="market-status-label">Best Session</div><div class="market-status-value" id="bestSession">-</div></div>
                            <div><div class="market-status-label">Risk</div><div class="market-status-value" id="riskLevel">-</div></div>
                        </div>
                        <div class="session-container">
                            <div class="session-header"><span class="session-title">TRADING SESSION</span><span class="session-status"><span class="session-dot" id="dashboardSessionDot"></span><span id="dashboardSessionStatus">...</span></span></div>
                            <div class="session-info">
                                <div class="session-item" id="sessionLondon"><div class="session-label">London</div><div class="session-value">10:00-19:00</div></div>
                                <div class="session-item" id="sessionNY"><div class="session-label">New York</div><div class="session-value">15:00-24:00</div></div>
                                <div class="session-item" id="sessionAsia"><div class="session-label">Asian</div><div class="session-value">00:00-09:00</div></div>
                                <div class="session-item"><div class="session-label">Server Time</div><div class="session-value" id="currentTime">--:--</div></div>
                            </div>
                        </div>
                    </div>

                    <!-- PANEL 2 : CHART -->
                    <div id="panelChart" class="mt5-panel">
                        <div class="chart-container" style="height:420px;">
                            <iframe id="chartIframe" title="TradingView Chart"></iframe>
                        </div>
                    </div>

                    <!-- PANEL 3 : TRADE (with 2 Take Profits) -->
                    <div id="panelTrade" class="mt5-panel">
                        <div class="signal-container">
                            <div class="signal-header">
                                <div class="signal-pair" id="signal-pair">EUR/USD</div>
                                <div class="signal-direction" id="signal-direction">LOADING</div>
                            </div>
                            <div class="signal-confidence">
                                <span style="font-size:12px;">Confidence:</span>
                                <div class="confidence-meter"><div class="confidence-fill" id="signalConfidenceFill"></div></div>
                                <div class="confidence-value" id="signalConfidenceValue">-</div>
                            </div>
                            <div id="signal-message" style="font-size:14px; margin-bottom:10px;">
                                <div style="display:flex; justify-content:center; align-items:center;"><div class="spinner" style="width:18px; height:18px;"></div><span style="margin-left:8px;">ANALYZING...</span></div>
                            </div>
                            <!-- 2 TAKE PROFITS + 1 STOP LOSS -->
                            <div class="signal-details">
                                <div class="signal-detail"><div class="detail-label">ENTRY</div><div class="detail-value" id="entry-price">-</div></div>
                                <div class="signal-detail"><div class="detail-label">TP 1</div><div class="detail-value" id="take-profit1">-</div></div>
                                <div class="signal-detail"><div class="detail-label">TP 2</div><div class="detail-value" id="take-profit2">-</div></div>
                                <div class="signal-detail"><div class="detail-label">STOP LOSS</div><div class="detail-value" id="stop-loss">-</div></div>
                            </div>
                            <div style="margin-top:12px; font-size:12px;"><strong>Analysis:</strong> <span id="signalAnalysisText"></span></div>
                        </div>
                        <div style="text-align:center;">
                            <button id="refreshBtn" class="refresh-btn"><i class="fas fa-sync-alt"></i> REFRESH SIGNAL</button>
                        </div>
                    </div>

                    <!-- PANEL 4 : HISTORY -->
                    <div id="panelHistory" class="mt5-panel">
                        <h4 style="color:var(--primary-color); margin-bottom:12px;"><i class="fas fa-history"></i> SIGNAL HISTORY</h4>
                        <div id="signalHistoryFull" class="signal-history-full"></div>
                    </div>

                    <!-- PANEL 5 : SETTINGS (account, strategy, session, owner) -->
                    <div id="panelSettings" class="mt5-panel">
                        <div style="display:flex; flex-direction:column; gap:18px;">
                            <div class="menu-section">
                                <h4>ACCOUNT DETAILS</h4>
                                <div class="user-detail"><strong>Name:</strong> <span id="settingsUserName">-</span></div>
                                <div class="user-detail"><strong>Email:</strong> <span id="settingsUserEmail">-</span></div>
                                <div class="user-detail"><strong>License:</strong> <span id="settingsLicenseKey" style="color:var(--primary-color);">-</span></div>
                                <div class="user-detail"><strong>Member since:</strong> <span id="settingsMemberSince">-</span></div>
                                <div class="user-detail"><strong>Style:</strong> <span id="settingsTradingStyle">-</span></div>
                            </div>
                            <div class="menu-section">
                                <h4>CHANGE STRATEGY</h4>
                                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                    <button id="settingsStyleScalpBtn" class="change-style-btn" style="flex:1;">SCALPING</button>
                                    <button id="settingsStyleDayBtn" class="change-style-btn" style="flex:1;">DAY</button>
                                    <button id="settingsStyleSwingBtn" class="change-style-btn" style="flex:1;">SWING</button>
                                </div>
                            </div>
                            <div class="menu-section">
                                <h4>CURRENT SESSION</h4>
                                <div class="user-detail"><strong>Session:</strong> <span id="settingsSession">-</span></div>
                                <div class="user-detail"><strong>Volatility:</strong> <span id="settingsVolatility">-</span></div>
                                <div class="user-detail"><strong>Server time:</strong> <span id="settingsTime">-</span></div>
                            </div>
                            <div class="owner-info">
                                <h4>FX BULLS PRO - V2+</h4>
                                <p><strong>OWNER:</strong> MFANOLA HAPE</p>
                                <p><strong>CONTACT:</strong> 067 277 1746</p>
                                <p><strong>EMAIL:</strong> fxbulls1632@gmail.com</p>
                                <p><strong>MEMBERSHIP:</strong> R300 LIFETIME</p>
                            </div>
                        </div>
                    </div>
                    <!-- POWERED footer -->
                    <div class="powered-by"><i class="fas fa-bolt"></i> POWERED BY FX BULLS PRO <i class="fas fa-bolt"></i></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== BOTTOM NAVIGATION – 5 TABS (always below) ========= -->
    <div class="bottom-nav">
        <button class="nav-item active" id="navQuotes"><i class="fas fa-chart-line"></i><span>QUOTES</span></button>
        <button class="nav-item" id="navChart"><i class="fas fa-chart-area"></i><span>CHART</span></button>
        <button class="nav-item" id="navTrade"><i class="fas fa-bolt"></i><span>TRADE</span></button>
        <button class="nav-item" id="navHistory"><i class="fas fa-history"></i><span>HISTORY</span></button>
        <button class="nav-item" id="navSettings"><i class="fas fa-cog"></i><span>SETTINGS</span></button>
    </div>

    <script>
        // ################## FULL ORIGINAL LOGIC – 100% KEPT + 2 TAKE PROFITS, ALL PAIRS FIX ##################
        const config = {
            apiKey: "96a47bf7705a477195b7837d3d99f190",
            pipValues: { "EUR/USD":0.0001, "GBP/USD":0.0001, "USD/JPY":0.01, "AUD/USD":0.0001, "USD/CAD":0.0001, "BTC/USD":1, "XAU/USD":0.1 },
            tradingStyles: {
                scalping: { tpMultiplier:1.5, slMultiplier:0.8, timeframe:"15", maxPips:1500, minPips:1000 },
                day: { tpMultiplier:3.0, slMultiplier:1.0, timeframe:"60", maxPips:2000, minPips:1200 },
                swing: { tpMultiplier:5.0, slMultiplier:1.5, timeframe:"240", maxPips:2500, minPips:1500 }
            },
            activationCodes: ["FXBULLS-206-PRO-EA","TRAD@567-BULLSEA-FX","PROFX56-12OIJM7","BULLSF--X0-1","ACTIVATE--/)(858KM87"],
            sessions: { asia:{start:0,end:9,name:"Asian"}, london:{start:10,end:19,name:"London"}, ny:{start:15,end:24,name:"New York"} }
        };

        function generateLicenseKeys(c){ let k=[]; for(let i=0;i<c;i++) k.push([Math.random().toString(36).substring(2,6).toUpperCase(),Math.random().toString(36).substring(2,6).toUpperCase(),Math.random().toString(36).substring(2,6).toUpperCase(),Math.random().toString(36).substring(2,6).toUpperCase()].join('-')); return k; }
        const licenseKeys = generateLicenseKeys(1000); let availableKeys = [...licenseKeys]; let usedKeys = {}; const userDatabase = {}; let signalHistory = []; let marketDataCache = {};

        // DOM elements (full)
        const elements = {
            loginContainer:document.getElementById("login-container"), loginForm:document.getElementById("login-form"), registerForm:document.getElementById("register-form"),
            licenseKeyDisplay:document.getElementById("license-key-display"), dashboard:document.getElementById("dashboard"), userNameDisplay:document.getElementById("userNameDisplay"),
            userTradingStyleDisplay:document.getElementById("userTradingStyleDisplay"), pairSelect:document.getElementById("pairSelect"), signalPair:document.getElementById("signal-pair"),
            signalDirection:document.getElementById("signal-direction"), signalMessage:document.getElementById("signal-message"), entryPrice:document.getElementById("entry-price"),
            takeProfit1:document.getElementById("take-profit1"), takeProfit2:document.getElementById("take-profit2"), stopLoss:document.getElementById("stop-loss"),
            chartIframe:document.getElementById("chartIframe"), loginBtn:document.getElementById("loginBtn"), registerBtn:document.getElementById("registerBtn"),
            logoutBtn:document.getElementById("logoutBtn"), refreshBtn:document.getElementById("refreshBtn"), showRegister:document.getElementById("showRegister"),
            showLogin:document.getElementById("showLogin"), goToLogin:document.getElementById("goToLogin"), generatedLicenseKey:document.getElementById("generated-license-key"),
            activationCodeInput:document.getElementById("activationCode"), tradingStyleSelect:document.getElementById("tradingStyle"),
            loginEmail:document.getElementById("loginEmail"), loginPassword:document.getElementById("loginPassword"), loginLicenseKey:document.getElementById("loginLicenseKey"),
            regName:document.getElementById("regName"), regEmail:document.getElementById("regEmail"), regPassword:document.getElementById("regPassword"),
            regConfirmPassword:document.getElementById("regConfirmPassword"), hamburgerMenu:document.getElementById("hamburgerMenu"), menuOverlay:document.getElementById("menuOverlay"),
            menuContent:document.getElementById("menuContent"), closeMenu:document.getElementById("closeMenu"), menuUserName:document.getElementById("menuUserName"),
            menuUserEmail:document.getElementById("menuUserEmail"), menuTradingStyle:document.getElementById("menuTradingStyle"), menuMemberSince:document.getElementById("menuMemberSince"),
            sessionDot:document.getElementById("sessionDot"), sessionStatus:document.getElementById("sessionStatus"), sessionTime:document.getElementById("sessionTime"),
            currentSession:document.getElementById("currentSession"), sessionVolatility:document.getElementById("sessionVolatility"), menuCurrentSignal:document.getElementById("menuCurrentSignal"),
            confidenceLevel:document.getElementById("confidenceLevel"), confidenceFill:document.getElementById("confidenceFill"), signalAnalysis:document.getElementById("signalAnalysis"),
            signalHistoryList:document.getElementById("signalHistoryList"), changeStyleBtn:document.getElementById("changeStyleBtn"), styleOptions:document.getElementById("styleOptions"),
            marketStatus:document.getElementById("marketStatus"), bestSession:document.getElementById("bestSession"), riskLevel:document.getElementById("riskLevel"),
            volatilityIndicator:document.getElementById("volatilityIndicator"), dashboardSessionDot:document.getElementById("dashboardSessionDot"),
            dashboardSessionStatus:document.getElementById("dashboardSessionStatus"), currentTime:document.getElementById("currentTime"),
            sessionLondon:document.getElementById("sessionLondon"), sessionNY:document.getElementById("sessionNY"), sessionAsia:document.getElementById("sessionAsia"),
            signalConfidenceFill:document.getElementById("signalConfidenceFill"), signalConfidenceValue:document.getElementById("signalConfidenceValue"),
            signalAnalysisText:document.getElementById("signalAnalysisText"), payNowButton:document.getElementById("payNowButton"),
            // panels + nav
            panelQuotes:document.getElementById("panelQuotes"), panelChart:document.getElementById("panelChart"), panelTrade:document.getElementById("panelTrade"),
            panelHistory:document.getElementById("panelHistory"), panelSettings:document.getElementById("panelSettings"),
            navQuotes:document.getElementById("navQuotes"), navChart:document.getElementById("navChart"), navTrade:document.getElementById("navTrade"),
            navHistory:document.getElementById("navHistory"), navSettings:document.getElementById("navSettings"),
            signalHistoryFull:document.getElementById("signalHistoryFull"), settingsUserName:document.getElementById("settingsUserName"),
            settingsUserEmail:document.getElementById("settingsUserEmail"), settingsLicenseKey:document.getElementById("settingsLicenseKey"),
            settingsMemberSince:document.getElementById("settingsMemberSince"), settingsTradingStyle:document.getElementById("settingsTradingStyle"),
            settingsStyleScalpBtn:document.getElementById("settingsStyleScalpBtn"), settingsStyleDayBtn:document.getElementById("settingsStyleDayBtn"),
            settingsStyleSwingBtn:document.getElementById("settingsStyleSwingBtn"), settingsSession:document.getElementById("settingsSession"),
            settingsVolatility:document.getElementById("settingsVolatility"), settingsTime:document.getElementById("settingsTime")
        };

        // ---------- ALL ORIGINAL FUNCTIONS (unchanged except TPx2) ----------
        async function getCurrentPrice(s) { try { let ck=s+'_price', n=Date.now(); if(marketDataCache[ck]&&(n-marketDataCache[ck].timestamp<30000)) return marketDataCache[ck].price; let r=await fetch(`https://api.twelvedata.com/price?symbol=${s}&apikey=${config.apiKey}`), d=await r.json(); if(d.price){ let p=parseFloat(d.price); marketDataCache[ck]={price:p,timestamp:n}; return p; } else throw new Error(); } catch(e){ console.log(e); showError('Price error'); return null; } }
        async function getHistoricalData(s,iv="1hour",p=100){ try { let ck=s+iv+p; let n=Date.now(); if(marketDataCache[ck]&&n-marketDataCache[ck].timestamp<60000) return marketDataCache[ck].data; let r=await fetch(`https://api.twelvedata.com/time_series?symbol=${s}&interval=${iv}&outputsize=${p}&apikey=${config.apiKey}`), d=await r.json(); if(d.values){ let h=d.values.map(v=>({close:parseFloat(v.close),high:parseFloat(v.high),low:parseFloat(v.low),open:parseFloat(v.open),datetime:v.datetime})).reverse(); marketDataCache[ck]={data:h,timestamp:n}; return h; } else return null; } catch(e){ return null; } }
        function calculateRSI(p,per=14){ if(p.length<per+1) return 50; let g=0,l=0; for(let i=1;i<=per;i++){ let ch=p[i]-p[i-1]; if(ch>=0) g+=ch; else l-=ch; } let ag=g/per, al=l/per; for(let i=per+1;i<p.length;i++){ let ch=p[i]-p[i-1]; if(ch>=0){ ag=((ag*(per-1))+ch)/per; al=(al*(per-1))/per; }else{ ag=(ag*(per-1))/per; al=((al*(per-1))-ch)/per; } } if(al===0) return 100; return 100-(100/(1+(ag/al))); }
        function calculateEMA(p,per){ if(p.length<per) return null; let k=2/(per+1); let ema=p.slice(0,per).reduce((a,b)=>a+b,0)/per; for(let i=per;i<p.length;i++) ema=(p[i]*k)+(ema*(1-k)); return ema; }
        function calculateMACD(p){ if(p.length<35) return {macd:0,signal:0}; let e12=calculateEMA(p,12), e26=calculateEMA(p,26); if(!e12||!e26) return {macd:0,signal:0}; let m=e12-e26; let rp=p.slice(-26), e12r=calculateEMA(rp,12), e26r=calculateEMA(rp,26); let s=e12r&&e26r?e12r-e26r:m; return {macd:m,signal:s}; }
        function calculateBollingerBands(p,per=20){ if(p.length<per) return {upper:0,middle:0,lower:0}; let r=p.slice(-per), mid=r.reduce((a,b)=>a+b,0)/per, var_=r.reduce((a,b)=>a+Math.pow(b-mid,2),0)/per, std=Math.sqrt(var_), mult=Math.min(2.5,Math.max(1.5,std/mid*100)); return {upper:mid+mult*std,middle:mid,lower:mid-mult*std}; }
        function calculateStochastic(p,per=14){ if(p.length<per) return {k:50,d:50}; let r=p.slice(-per), l=Math.min(...r), h=Math.max(...r), cur=p[p.length-1]; let k=((cur-l)/(h-l))*100; let d=r.slice(-3).reduce((sum,price,idx,arr)=>{ let rl=Math.min(...arr.slice(0,idx+1)), rh=Math.max(...arr.slice(0,idx+1)); return sum+((price-rl)/(rh-rl))*100; },0)/Math.min(3,r.length); return {k,d}; }
        function calculateATR(highs,lows,closes,per=14){ if(closes.length<per+1) return 0; let tr=[]; for(let i=1;i<closes.length;i++) tr.push(Math.max(highs[i]-lows[i],Math.abs(highs[i]-closes[i-1]),Math.abs(lows[i]-closes[i-1]))); return tr.slice(-per).reduce((a,b)=>a+b,0)/per; }

        async function analyzeMarket(pair,price){ try { let hist=await getHistoricalData(pair,"1hour",100); if(!hist||hist.length<50) return enhancedFallback(pair,price); let cp=hist.map(d=>d.close), hi=hist.map(d=>d.high), lo=hist.map(d=>d.low); let rsi=calculateRSI(cp,14), macd=calculateMACD(cp), bb=calculateBollingerBands(cp), stoc=calculateStochastic(cp), ema50=calculateEMA(cp,50), atr=calculateATR(hi,lo,cp); let recentHigh=Math.max(...cp.slice(-20)), recentLow=Math.min(...cp.slice(-20)), pos=(price-recentLow)/(recentHigh-recentLow)||0.5; let trend=ema50?(price>ema50?1:-1):0; let hh=new Date().getHours(); let overlap=(hh>=15&&hh<19), active=(hh>=10&&hh<19)||(hh>=15&&hh<24); let conf=0; if(rsi<30) conf+=0.3; if(rsi>70) conf-=0.3; if(macd.macd>macd.signal) conf+=0.2; if(macd.macd<macd.signal) conf-=0.2; if(price<bb.lower) conf+=0.25; if(price>bb.upper) conf-=0.25; if(stoc.k<20) conf+=0.15; if(stoc.k>80) conf-=0.15; if(trend>0) conf+=0.1; if(trend<0) conf-=0.1; if(overlap) conf+=0.2; if(active) conf+=0.1; if(pos<0.3) conf+=0.15; if(pos>0.7) conf-=0.15; let dir=conf>0.2?"BUY":conf<-0.2?"SELL":trend>0?"BUY":"SELL"; let cnf=Math.min(1,Math.max(0,Math.abs(conf)*1.5)); return {direction:dir,confidence:cnf,volatility:atr/price*100||0.01}; } catch(e){ return enhancedFallback(pair,price); } }
        function enhancedFallback(pair,price){ let pf={"EUR/USD":0.1,"GBP/USD":-0.2,"USD/JPY":0.3,"AUD/USD":-0.1,"USD/CAD":0.2,"BTC/USD":0.5,"XAU/USD":-0.4}; let bias=pf[pair]||0; let h=new Date().getHours(); let ov=(h>=15&&h<19)?0.3:0, act=(h>=10&&h<19||h>=15&&h<24)?0.2:0; let rand=(Math.random()*0.4)-0.2; let total=bias+ov+act+rand; let dir=total>0.2?"BUY":total<-0.2?"SELL":Math.random()>0.5?"BUY":"SELL"; let conf=Math.min(0.85,Math.max(0.4,Math.abs(total)+0.3)); return {direction:dir,confidence:conf,volatility:0.0009}; }

        async function generateSignal(tradingStyle){ if(!tradingStyle) tradingStyle=localStorage.getItem("userTradingStyle")||"day";
            elements.signalMessage.innerHTML=`<div style="display:flex; justify-content:center;"><div class="spinner" style="width:20px; height:20px;"></div><span style="margin-left:10px;">ANALYZING ${elements.pairSelect.value}...</span></div>`;
            let pair=elements.pairSelect.value, price=await getCurrentPrice(pair); if(!price) return;
            let analysis=await analyzeMarket(pair,price); updateSignalConfidence(analysis);
            let pip=config.pipValues[pair]||0.0001, style=config.tradingStyles[tradingStyle]||config.tradingStyles.day;
            let basePips=style.minPips||1000; let confMult=0.5+(analysis.confidence*0.5);
            let tpPips=Math.round(basePips*confMult); tpPips=Math.max(style.minPips||1000,tpPips);
            let slPips=Math.round(tpPips*0.3*Math.max(0.5,Math.min(1.5,analysis.volatility*8||1))); slPips=Math.max(100,slPips);
            let tp1Pips=Math.round(tpPips*0.6); let tp2Pips=tpPips;
            let dec=pair==="BTC/USD"?2:(pair==="XAU/USD"?2:5);
            let entry=price.toFixed(dec), tp1, tp2, sl;
            if(analysis.direction==="BUY"){
                tp1=(parseFloat(entry)+(tp1Pips*pip)).toFixed(dec);
                tp2=(parseFloat(entry)+(tp2Pips*pip)).toFixed(dec);
                sl=(parseFloat(entry)-(slPips*pip)).toFixed(dec);
            } else {
                tp1=(parseFloat(entry)-(tp1Pips*pip)).toFixed(dec);
                tp2=(parseFloat(entry)-(tp2Pips*pip)).toFixed(dec);
                sl=(parseFloat(entry)+(slPips*pip)).toFixed(dec);
            }
            elements.entryPrice.textContent=entry; elements.takeProfit1.textContent=tp1; elements.takeProfit2.textContent=tp2; elements.stopLoss.textContent=sl;
            elements.signalDirection.textContent=analysis.direction; elements.signalDirection.className="signal-direction "+analysis.direction.toLowerCase();
            if(pair==='XAU/USD') elements.signalDirection.style.color='var(--gold)'; else if(pair==='BTC/USD') elements.signalDirection.style.color='var(--bitcoin)';
            elements.signalPair.textContent=pair; 
            elements.signalMessage.innerHTML=`<div>SIGNAL READY • ${new Date().toLocaleTimeString()}</div><div style="font-size:11px;">TP1: ${tp1Pips} pips | TP2: ${tp2Pips} pips | SL: ${slPips} pips</div>`;
            let signal={pair, direction:analysis.direction, entry, tp1, tp2, sl, confidence:Math.round(analysis.confidence*100), timestamp:new Date()};
            updateCurrentSignal(signal); updateSignalHistory(); 
        }
        function updateSignalConfidence(a){ let c=Math.round(a.confidence*100); let txt=c>=80?'HIGH':c>=60?'GOOD':c>=40?'MODERATE':'LOW'; let cls=c>=60?'high':c>=40?'medium':'low'; elements.confidenceLevel.textContent=`${txt} (${c}%)`; elements.confidenceFill.style.width=c+'%'; elements.signalConfidenceValue.textContent=c+'%'; elements.signalConfidenceFill.className='confidence-fill '+cls; elements.signalConfidenceFill.style.width=c+'%'; elements.signalAnalysis.textContent=txt+' probability'; elements.signalAnalysisText.textContent=txt+' market confidence'; }
        function updateCurrentSignal(s){ let item={time:s.timestamp.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),pair:s.pair,dir:s.direction,entry:s.entry,tp1:s.tp1,tp2:s.tp2,sl:s.sl,conf:s.confidence}; signalHistory.unshift(item); if(signalHistory.length>15) signalHistory=signalHistory.slice(0,15); updateSignalHistory(); elements.menuCurrentSignal.textContent=`${s.pair} ${s.direction}`; }
        function updateSignalHistory(){ let histList=elements.signalHistoryList, histFull=elements.signalHistoryFull; if(histList){ let h=''; if(signalHistory.length===0) h='<div class="signal-history-item">No signals</div>'; else signalHistory.forEach(i=>{h+=`<div class="signal-history-item"><div style="display:flex;justify-content:space-between;"><strong>${i.time}</strong><span style="color:${i.dir==='BUY'?'var(--primary-color)':'var(--danger-color)'}">${i.dir}</span></div><div>${i.pair} Entry:${i.entry}</div><div>TP1:${i.tp1} TP2:${i.tp2} SL:${i.sl}</div><div style="color:var(--primary-color);">Conf:${i.conf}%</div></div>`;}); histList.innerHTML=h; } if(histFull){ let f=''; if(signalHistory.length===0) f='<div class="signal-history-item">No history</div>'; else signalHistory.forEach(i=>{f+=`<div class="signal-history-item"><div style="display:flex;justify-content:space-between;"><strong>${i.time}</strong><span style="color:${i.dir==='BUY'?'var(--primary-color)':'var(--danger-color)'}">${i.dir}</span></div><div>${i.pair} </div><div>Entry:${i.entry}  TP1:${i.tp1}  TP2:${i.tp2}</div><div>SL:${i.sl}  |  Confidence: ${i.conf}%</div></div>`;}); histFull.innerHTML=f; } }
        function showError(m){ elements.signalMessage.innerHTML=`<div class="error-message">${m}</div>`; }
        function updateTradingSession(){ let n=new Date(), h=n.getHours(), d=n.getDay(); let f=n.toLocaleTimeString('en-US',{hour12:false}); elements.sessionTime.textContent=f; elements.currentTime.textContent=f; if(elements.settingsTime) elements.settingsTime.textContent=f; let wd=d>=1&&d<=5, sess='Closed', active=false, vol='Low'; if(wd){ if(h>=10&&h<19){ sess='London'; active=true; vol=h>=15&&h<19?'VERY HIGH':'HIGH'; }else if(h>=15&&h<24){ sess='New York'; active=true; vol=h>=15&&h<19?'VERY HIGH':'HIGH'; }else if(h>=0&&h<10){ sess='Asian'; vol='Low'; } } elements.currentSession.textContent=sess+' Session'; elements.sessionVolatility.textContent=vol; elements.sessionStatus.textContent=active?'ACTIVE':'INACTIVE'; elements.dashboardSessionStatus.textContent=active?'ACTIVE':'INACTIVE'; let dot=active?'active':'inactive'; elements.sessionDot.className='session-dot '+dot; elements.dashboardSessionDot.className='session-dot '+dot; if(elements.settingsSession) elements.settingsSession.textContent=sess+(active?' (active)':' (closed)'); if(elements.settingsVolatility) elements.settingsVolatility.textContent=vol; elements.marketStatus.textContent=active?'OPEN':'CLOSED'; elements.marketStatus.style.color=active?'var(--primary-color)':'var(--danger-color)'; let risk=vol.includes('HIGH')?'HIGH':vol=='Medium'?'MEDIUM':'LOW'; elements.riskLevel.textContent=risk; if(vol=='VERY HIGH'||vol=='HIGH') elements.volatilityIndicator.className='volatility-fill volatility-high'; else if(vol=='Medium') elements.volatilityIndicator.className='volatility-fill volatility-medium'; else elements.volatilityIndicator.className='volatility-fill volatility-low'; }
        function handleRegister(){ let n=elements.regName.value.trim(), e=elements.regEmail.value.trim().toLowerCase(), p=elements.regPassword.value, cp=elements.regConfirmPassword.value, ts=elements.tradingStyleSelect.value, ac=elements.activationCodeInput.value.trim(); if(!n||!e||!p||!cp||!ac) return alert('All fields required'); if(p!==cp) return alert('Passwords mismatch'); if(p.length<6) return alert('Password min 6'); if(userDatabase[e]) return alert('Email exists'); if(!config.activationCodes.includes(ac)) return alert('Invalid activation code'); if(availableKeys.length===0) return alert('No keys'); let lk=availableKeys.pop(); usedKeys[lk]=e; userDatabase[e]={name:n,password:p,licenseKey:lk,tradingStyle:ts}; elements.generatedLicenseKey.textContent=lk; elements.registerForm.classList.add('hidden'); elements.licenseKeyDisplay.classList.remove('hidden'); }
        function handleLogin(){ let e=elements.loginEmail.value.trim().toLowerCase(), p=elements.loginPassword.value, lk=elements.loginLicenseKey.value.trim(); if(!e||!p||!lk) return alert('Fill all'); let u=userDatabase[e]; if(!u) return alert('User not found'); if(u.password!==p) return alert('Wrong password'); if(u.licenseKey!==lk) return alert('Invalid license'); localStorage.setItem('loggedIn','true'); localStorage.setItem('userEmail',e); localStorage.setItem('userName',u.name); localStorage.setItem('userTradingStyle',u.tradingStyle); localStorage.setItem('licenseKey',lk); showDashboard(u.name,u.tradingStyle); updateMenuUserDetails(u.name,e,u.tradingStyle); setActiveStyleOption(u.tradingStyle); }
        function showDashboard(n,s){ elements.loginContainer.classList.add('hidden'); elements.dashboard.classList.remove('hidden'); elements.userNameDisplay.textContent=n.toUpperCase(); updateDashboardTradingStyle(s); updateChart(s); generateSignal(s); updateSettingsFields(); }
        function updateSettingsFields(){ let e=localStorage.getItem('userEmail'), u=e?userDatabase[e]:null; if(elements.settingsUserName) elements.settingsUserName.textContent=localStorage.getItem('userName')||'-'; if(elements.settingsUserEmail) elements.settingsUserEmail.textContent=e||'-'; if(elements.settingsLicenseKey) elements.settingsLicenseKey.textContent=localStorage.getItem('licenseKey')||'-'; let ms=localStorage.getItem('memberSince')||new Date().toLocaleDateString(); localStorage.setItem('memberSince',ms); if(elements.settingsMemberSince) elements.settingsMemberSince.textContent=ms; let sty=localStorage.getItem('userTradingStyle')||'day'; if(elements.settingsTradingStyle) elements.settingsTradingStyle.textContent=getStyleName(sty); }
        function getStyleName(s){ return s==='scalping'?'Scalping':s==='day'?'Day Trading':'Swing Trading'; }
        function updateDashboardTradingStyle(s){ elements.userTradingStyleDisplay.textContent=getStyleName(s).toUpperCase(); }
        function updateMenuUserDetails(n,e,s){ elements.menuUserName.textContent=n; elements.menuUserEmail.textContent=e; elements.menuTradingStyle.textContent=getStyleName(s); let ms=localStorage.getItem('memberSince')||new Date().toLocaleDateString('en-US',{day:'2-digit',month:'short',year:'numeric'}); localStorage.setItem('memberSince',ms); elements.menuMemberSince.textContent=ms; }
        function setActiveStyleOption(s){ document.querySelectorAll('.style-option').forEach(o=>{ o.classList.remove('active'); let inp=o.querySelector('input'); if(inp&&inp.value===s){ o.classList.add('active'); inp.checked=true; } }); }
        function updateChart(s){ let pair=elements.pairSelect.value; let sym=pair.replace('/',''); let tf=config.tradingStyles[s]?.timeframe||'15'; elements.chartIframe.src=`https://s.tradingview.com/widgetembed/?symbol=${sym}&interval=${tf}&theme=dark&style=1&timezone=Africa/Johannesburg&hide_side_toolbar=true`; }
        function handleLogout(){ localStorage.clear(); location.reload(); }
        function toggleMenu(){ elements.menuContent.classList.toggle('active'); elements.menuOverlay.style.display=elements.menuContent.classList.contains('active')?'block':'none'; }
        function closeMenu(){ elements.menuContent.classList.remove('active'); elements.menuOverlay.style.display='none'; if(elements.styleOptions) elements.styleOptions.classList.remove('active'); }
        // ----- Tab switching (bottom nav) -----
        function switchPanel(panelId){
            ['panelQuotes','panelChart','panelTrade','panelHistory','panelSettings'].forEach(p=>{ if(elements[p]) elements[p].classList.remove('active-panel'); });
            [elements.navQuotes, elements.navChart, elements.navTrade, elements.navHistory, elements.navSettings].forEach(b=>{ if(b) b.classList.remove('active'); });
            if(panelId==='quotes'){ elements.panelQuotes.classList.add('active-panel'); elements.navQuotes.classList.add('active'); }
            else if(panelId==='chart'){ elements.panelChart.classList.add('active-panel'); elements.navChart.classList.add('active'); }
            else if(panelId==='trade'){ elements.panelTrade.classList.add('active-panel'); elements.navTrade.classList.add('active'); }
            else if(panelId==='history'){ elements.panelHistory.classList.add('active-panel'); elements.navHistory.classList.add('active'); updateSignalHistory(); }
            else if(panelId==='settings'){ elements.panelSettings.classList.add('active-panel'); elements.navSettings.classList.add('active'); updateSettingsFields(); }
        }

        // ----- EVENT LISTENERS -----
        function init(){
            elements.loginBtn.addEventListener('click',handleLogin);
            elements.registerBtn.addEventListener('click',handleRegister);
            elements.logoutBtn.addEventListener('click',handleLogout);
            elements.refreshBtn.addEventListener('click',()=>{ let s=localStorage.getItem('userTradingStyle'); generateSignal(s); });
            elements.pairSelect.addEventListener('change',()=>{ let s=localStorage.getItem('userTradingStyle'); updateChart(s); generateSignal(s); });
            elements.showRegister.addEventListener('click',()=>{ elements.loginForm.classList.add('hidden'); elements.registerForm.classList.remove('hidden'); });
            elements.showLogin.addEventListener('click',()=>{ elements.registerForm.classList.add('hidden'); elements.loginForm.classList.remove('hidden'); });
            elements.goToLogin.addEventListener('click',()=>{ elements.licenseKeyDisplay.classList.add('hidden'); elements.loginForm.classList.remove('hidden'); });
            elements.hamburgerMenu.addEventListener('click',toggleMenu); elements.menuOverlay.addEventListener('click',closeMenu); elements.closeMenu.addEventListener('click',closeMenu);
            elements.changeStyleBtn.addEventListener('click',()=>{ if(elements.styleOptions) elements.styleOptions.classList.toggle('active'); });
            document.querySelectorAll('.style-option').forEach(opt=>{ opt.addEventListener('click',function(){ let style=this.getAttribute('data-style'); let email=localStorage.getItem('userEmail'); if(email&&userDatabase[email]) userDatabase[email].tradingStyle=style; localStorage.setItem('userTradingStyle',style); updateMenuTradingStyle(style); updateDashboardTradingStyle(style); setActiveStyleOption(style); if(elements.styleOptions) elements.styleOptions.classList.remove('active'); generateSignal(style); updateSettingsFields(); }); });
            // settings style btns
            if(elements.settingsStyleScalpBtn) elements.settingsStyleScalpBtn.addEventListener('click',()=> changeStyle('scalping'));
            if(elements.settingsStyleDayBtn) elements.settingsStyleDayBtn.addEventListener('click',()=> changeStyle('day'));
            if(elements.settingsStyleSwingBtn) elements.settingsStyleSwingBtn.addEventListener('click',()=> changeStyle('swing'));
            function changeStyle(st){ let email=localStorage.getItem('userEmail'); if(email&&userDatabase[email]) userDatabase[email].tradingStyle=st; localStorage.setItem('userTradingStyle',st); updateMenuTradingStyle(st); updateDashboardTradingStyle(st); setActiveStyleOption(st); generateSignal(st); updateSettingsFields(); alert('Trading style updated'); }
            function updateMenuTradingStyle(st){ if(elements.menuTradingStyle) elements.menuTradingStyle.textContent=getStyleName(st); }

            // BOTTOM NAVIGATION
            elements.navQuotes.addEventListener('click',()=> switchPanel('quotes'));
            elements.navChart.addEventListener('click',()=> switchPanel('chart'));
            elements.navTrade.addEventListener('click',()=> switchPanel('trade'));
            elements.navHistory.addEventListener('click',()=> switchPanel('history'));
            elements.navSettings.addEventListener('click',()=> switchPanel('settings'));

            if(localStorage.getItem('loggedIn')==='true'){ let em=localStorage.getItem('userEmail'), nm=localStorage.getItem('userName'), ts=localStorage.getItem('userTradingStyle'); if(em&&nm) { showDashboard(nm,ts||'day'); updateMenuUserDetails(nm,em,ts||'day'); setActiveStyleOption(ts||'day'); } }
            updateTradingSession(); setInterval(updateTradingSession,1000);
        }
        document.addEventListener('DOMContentLoaded',init);
    </script>
</body>
</html>
